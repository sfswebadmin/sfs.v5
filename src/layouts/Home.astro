---
import BaseLayout from './Base.astro';
const { content } = Astro.props;
const season = '2022-2023';

import filmData from '../data/films.json';
const films = filmData.films;
const bannerFilms = filmData.bannerFilms;
const bannerTitle = filmData.bannerFilmsTitle;
const ratingsTotal = filmData.ratingsTotal;

function hasRating(attendance, taglink, ratingsAverage) {
    let btn = "";

    if (attendance !== 0) {
        btn = `<button type="button" class="btn btn-default btn-warning btn-film-listing"
                title="${taglink}"" data-toggle="collapse" data-target="${"#collapse" + taglink}" 
                aria-expanded="false" aria-controls="${"collapse" + taglink}">
                Approval ${ratingsAverage}% <span class="caret"></span></button>`
    }

    return btn;
}

---

<BaseLayout title={content.title}>
    <div class="row">
        <div class="col-xs-12 col-md-9 front-page-text">
            <slot />
        </div>
        <div class="col-xs-12 col-md-3">
            <div class="membership-box">
                <h3 class="text-center">Become a member</h3>
                <div class="membership-box-button">
                    <a href="/membership/">
                        <button class="btn btn-warning center-block btn-membership">Membership and Tickets</button>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <section class="col-md-12">
            <h3>{bannerTitle}</h3>
            <div class="row">
                {bannerFilms.map((film) => (
                <div class="col-md-4">
                    <div class="poster-box">
                        <div class="row poster-box-date">
                            <div class="col-md-12 text-center">Showing: {film.dateShowing}</div>
                        </div>
                        <img src={film.posterImage} alt={film.title + " film poster" } class="img-responsive">
                        <div class="row poster-box-link">
                            <div class="col-md-12 text-center"><a href={'#' + film.taglink}>More Info...</a>
                            </div>
                        </div>
                    </div>
                </div>
                ))}
            </div>
        </section> <!-- end of banner section -->
    </div>

    <div class="row">
        <section class="col-md-12">
            <a id="sfsfilms"></a>
            <h3>Our Film Season {season}</h3>
            <p>
                <strong>Doors open 30 minutes before a show.</strong>
                We donâ€™t show any adverts, so please make sure to arrive in good time to get your ticket and seat.
            </p>
            {films.map((film) => (
            <article class="row film-article">
                <a id={film.taglink}></a>
                <div class="col-xs-12 col-md-4">
                    <img class="img-responsive film-screenshot-front-page" src={film.filmImage}
                        title="{ film.title } film screenshot" alt="{ film.title } film screenshot" />
                </div>
                <div class="col-xs-12 col-md-8">
                    <h3>{ film.title.toUpperCase() }</h3>
                    <p class="date-venue-paragraph"><strong>{ film.dayShowing } { film.dateShowing }, {
                            film.timeShowing }, { film.locationShowing }</strong></p>
                    <p class="film-info-line">{ film.releaseDate } | { film.country } | { film.duration } | {
                        film.certificate } | { film.genreName }</p>
                    <div class="film-snippet"> { film.frontPageSnippet }</div>
                    <div class="row button-bar">
                        <div class="col-md-8 front-page-buttons">
                            <a href={film.trailerLink} class="btn btn-warning btn-film-listing"
                                target="_blank">Trailer</a>
                            <a href={film.reviewsLink} class="btn btn-warning btn-film-listing"
                                target="_blank">Reviews</a>
                            <a href={film.synopsisLink} class="btn btn-warning btn-film-listing">Synopsis</a>

                            <Fragment set:html={hasRating(film.attendance, film.taglink, film.ratingsAverage)} />

                            <a href="/membership/" class="btn btn-default btn-film-listing btn-tickets">Tickets</a>

                        </div>
                    </div>
                </div>
                <div class="col-xs-12 col-md-offset-4 col-md-8">
                    <div class="collapse" id={ 'collapse' + film.taglink }>
                        <table class="table reactions-table">
                            <thead>
                                <tr>
                                    <th>Attendance</th>
                                    <th>Returns</th>
                                    <th>5 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                                    <th>4 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                                    <th>3 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                                    <th>2 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                                    <th>1 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                                    <th>Average</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{ film.attendance }</td>
                                    <td>{ film.returns }</td>
                                    <td>{ film.excellent }</td>
                                    <td>{ film.good }</td>
                                    <td>{ film.average }</td>
                                    <td>{ film.disappointing }</td>
                                    <td>{ film.awful } </td>
                                    <td>{ film.ratingsAverage }%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </article>
            ))}

        </section>
        <!--End of film summary section-->

    </div> <!-- row end -->

    <div class="row">
        <section class="col-md-offset-4 col-md-8">
            <h3>Overall Audience Feedback</h3>
            <p>
                The table below represents the audience feedback, for all films shown to date.
            </p>
            <table class="table reactions-table">
                <thead>
                    <tr>
                        <th>Attendance</th>
                        <th>Returns</th>
                        <th>5 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                        <th>4 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                        <th>3 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                        <th>2 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                        <th>1 <span class="glyphicon glyphicon-star" aria-hidden="true"></span></th>
                        <th>Average</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{ ratingsTotal.attendance }</td>
                        <td>{ ratingsTotal.returns }</td>
                        <td>{ ratingsTotal.excellent }</td>
                        <td>{ ratingsTotal.good }</td>
                        <td>{ ratingsTotal.average }</td>
                        <td>{ ratingsTotal.disappointing }</td>
                        <td>{ ratingsTotal.awful } </td>
                        <td>{ ratingsTotal.ratingsAverage }%</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </div>

</BaseLayout>